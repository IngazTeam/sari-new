# ملف الفحص الشامل لمشروع Sari

## معلومات المشروع
- **اسم المشروع**: Sari - AI Sales Agent for WhatsApp
- **المسار**: `/home/ubuntu/sari`
- **الإصدار**: 3394ef7c
- **الميزات**: server, db, user
- **حالة الخادم**: قيد التشغيل
- **الرابط**: https://3000-i2p6cd0zb6qb4wcyphorn-356c60d6.manus-asia.computer

---

## متغيرات البيئة المتوفرة
✅ المتغيرات التالية متاحة تلقائياً:
- `GREEN_API_INSTANCE_ID` - معرف حساب Green API
- `GREEN_API_TOKEN` - رمز المصادقة لـ Green API
- `OPENAI_API_KEY` - مفتاح OpenAI للذكاء الاصطناعي
- `DATABASE_URL` - اتصال قاعدة البيانات
- `JWT_SECRET` - سر الجلسات
- `VITE_APP_ID` - معرف التطبيق
- `OWNER_NAME` - اسم المالك
- `OWNER_OPEN_ID` - معرف المالك

---

## الملفات الرئيسية المُنشأة
- ✅ `client/src/App.tsx` - التوجيه والتخطيط
- ✅ `client/src/lib/trpc.ts` - عميل tRPC
- ✅ `client/src/pages/Home.tsx` - الصفحة الرئيسية
- ✅ `drizzle/schema.ts` - مخطط قاعدة البيانات
- ✅ `package.json` - تبعيات المشروع
- ✅ `server/auth.logout.test.ts` - اختبار المصادقة
- ✅ `server/db.ts` - مساعدات قاعدة البيانات
- ✅ `server/routers.ts` - إجراءات tRPC

---

## الميزات المطلوبة (من المستخدم)

### 1. إدارة العملاء المحتملين (Leads)
- [ ] جدول قاعدة بيانات للعملاء المحتملين
- [ ] حفظ معلومات العميل (الاسم، رقم الهاتف، الحالة، التاريخ)
- [ ] واجهة عرض قائمة العملاء
- [ ] تصفية وبحث في العملاء

### 2. تكامل WhatsApp (Green API)
- [ ] إعداد اتصال Green API
- [ ] استقبال الرسائل من WhatsApp
- [ ] إرسال الرسائل إلى WhatsApp
- [ ] معالجة Webhook للرسائل الواردة

### 3. الذكاء الاصطناعي (OpenAI)
- [ ] تكامل OpenAI API
- [ ] معالجة رسائل العملاء بالذكاء الاصطناعي
- [ ] توليد ردود ذكية
- [ ] تخصيص سلوك البوت

### 4. إدارة المحادثات
- [ ] جدول قاعدة بيانات للمحادثات
- [ ] حفظ سجل المحادثات
- [ ] عرض المحادثات في الواجهة
- [ ] ربط المحادثات بالعملاء

### 5. لوحة التحكم (Dashboard)
- [ ] إحصائيات العملاء
- [ ] عدد المحادثات النشطة
- [ ] معدل التحويل
- [ ] رسوم بيانية للأداء

### 6. الإشعارات
- [ ] إشعار عند وصول عميل جديد
- [ ] إشعار عند رسالة مهمة
- [ ] استخدام `notifyOwner` للإشعارات

---

## البنية التقنية

### قاعدة البيانات (Schema)
```
users - جدول المستخدمين (موجود افتراضياً)
leads - العملاء المحتملين
conversations - المحادثات
messages - الرسائل
```

### الإجراءات (tRPC Procedures)
```
leads.list - قائمة العملاء
leads.create - إضافة عميل
leads.update - تحديث عميل
conversations.list - قائمة المحادثات
conversations.getById - تفاصيل محادثة
whatsapp.sendMessage - إرسال رسالة
whatsapp.webhook - استقبال الرسائل
ai.processMessage - معالجة رسالة بالذكاء الاصطناعي
```

---

## خطوات التنفيذ

### المرحلة 1: قاعدة البيانات ✅
1. تصميم مخطط الجداول في `drizzle/schema.ts`
2. تنفيذ `pnpm db:push` لتطبيق التغييرات
3. إضافة مساعدات الاستعلام في `server/db.ts`

### المرحلة 2: Backend API
1. إنشاء إجراءات tRPC في `server/routers.ts`
2. تكامل Green API للواتساب
3. تكامل OpenAI للذكاء الاصطناعي
4. إعداد Webhook لاستقبال الرسائل

### المرحلة 3: Frontend UI
1. تصميم لوحة التحكم
2. صفحة قائمة العملاء
3. صفحة المحادثات
4. واجهة الإحصائيات

### المرحلة 4: الاختبار والتسليم
1. كتابة اختبارات Vitest
2. اختبار التكاملات
3. إنشاء Checkpoint
4. التسليم للمستخدم

---

## ملاحظات مهمة

### Green API
- استخدام متغيرات البيئة: `GREEN_API_INSTANCE_ID`, `GREEN_API_TOKEN`
- API Endpoint: `https://api.green-api.com`
- الوثائق: https://green-api.com/docs/

### OpenAI
- استخدام `invokeLLM` من `server/_core/llm.ts`
- لا حاجة لإعداد يدوي، المفتاح متوفر تلقائياً

### الإشعارات
- استخدام `notifyOwner` من `server/_core/notification.ts`
- للإشعارات المهمة فقط (عميل جديد، رسالة مهمة)

---

## التحديات المحتملة

1. **Webhook من Green API**
   - يحتاج إلى endpoint عام
   - استخدام `/api/webhook/whatsapp` كنقطة استقبال

2. **معالجة الرسائل في الوقت الفعلي**
   - استخدام polling أو webhooks
   - حفظ الحالة في قاعدة البيانات

3. **إدارة السياق في المحادثات**
   - حفظ سجل المحادثات
   - إرسال السياق للذكاء الاصطناعي

---

## قائمة المراجعة النهائية

- [ ] جميع الجداول منشأة ومهاجرة
- [ ] جميع الإجراءات منفذة ومختبرة
- [ ] الواجهة الأمامية كاملة وجذابة
- [ ] التكاملات تعمل (WhatsApp + AI)
- [ ] الاختبارات تمر بنجاح
- [ ] todo.md محدث بجميع الميزات
- [ ] Checkpoint تم إنشاؤه
- [ ] المستخدم راضٍ عن النتيجة

---

**آخر تحديث**: تم الإنشاء في بداية المشروع
**الحالة**: جاهز للبدء في التطوير
